/*!
 * vue-diagram-editor v1.2.1 | (c) 2021 Maksim Kutishchev
 * Released under the Apache 2 License.
 * https://vue-diagram-editor.js.org
 */
module.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=7)}([function(e,t){e.exports=require("vue")},function(e,t){e.exports=require("lodash/isEqual")},function(e,t){e.exports=require("ulid")},function(e,t){e.exports=require("lodash/cloneDeep")},function(e,t){e.exports=require("svg-pan-zoom")},function(e,t){e.exports=require("lodash/throttle")},function(e,t,n){},function(e,t,n){"use strict";n.r(t),n.d(t,"Diagram",(function(){return U})),n.d(t,"Node",(function(){return p})),n.d(t,"Link",(function(){return E})),n.d(t,"Size",(function(){return l})),n.d(t,"Coordinates",(function(){return a}));var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"diagram-editor__wrapper"},[n("DiagramRoot",{ref:"diagram",attrs:{width:e.width,height:e.height,"grid-snap":e.gridSnap,"zoom-enabled":e.zoomEnabled,"node-color":e.nodeColor,"node-pulsable":e.nodePulsable,"node-deletable":e.nodeDeletable,"node-pulse-color":e.nodePulseColor,"before-delete-node":e.beforeDeleteNode,"before-delete-link":e.beforeDeleteLink,"port-disabled":e.portDisabled,"port-available":e.portAvailable,pan:e.pan,"prevent-mouse-events-default":e.preventMouseEventsDefault},on:{"select-node":function(t){return e.$emit("select-node",t)},"deleted-node":function(t){return e.$emit("deleted-node",t)},"deleted-link":function(t){return e.$emit("deleted-link",t)},"updated-node":function(t){return e.$emit("updated-node",t)},"click-port":function(t){return e.$emit("click-port",t)},"created-link":function(t){return e.$emit("created-link",t)}},scopedSlots:e._u([{key:"default",fn:function(t){return[e._t("node",null,null,t)]}}],null,!0)})],1)};r._withStripped=!0;var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("svg",{ref:"diagramRoot",staticClass:"diagram-editor__svg-content",attrs:{id:"diagram-root-"+e.uniqId,version:"1.1",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 "+e.width/1.2+" "+e.height/1.2,width:e.width,height:e.height,preserveAspectRatio:"xMinYMin meet"}},[n("g",{ref:"viewPort",staticClass:"svg-pan-zoom_viewport",attrs:{x:"50",y:"50"}},[n("defs",[n("pattern",{attrs:{id:"diagram-small-grid-"+e.uniqId,width:"16",height:"16",patternUnits:"userSpaceOnUse"}},[n("path",{attrs:{d:"M 16 0 L 0 0 0 16",fill:"none",stroke:"#ccc","stroke-width":"0.5"}})]),n("pattern",{attrs:{id:"diagram-grid-"+e.uniqId,width:"80",height:"80",patternUnits:"userSpaceOnUse"}},[n("rect",{attrs:{width:"80",height:"80",fill:"url(#diagram-small-grid-"+e.uniqId+")"}}),n("path",{attrs:{d:"M 80 0 L 0 0 0 80",fill:"none",stroke:"#ccc","stroke-width":"1"}})])]),n("rect",{ref:"grid",attrs:{x:"-5000px",y:"-5000px",width:"10000px",height:"10000px",fill:"url(#diagram-grid-"+e.uniqId+")"},on:{mousedown:e.clearSelection}}),e._l(e.links,(function(t){return n("DiagramLink",{key:t.id,attrs:{id:t.id,link:t,"node-start":e.nodes[t.start_id],"node-end":e.nodes[t.end_id],selected:e.selectedLink===t.id},on:{mousedown:function(n){return e.selectLink(t.id)}}})})),e._l(e.nodes,(function(t){return n("DiagramNode",{key:t.id,attrs:{node:t,color:e.nodeColor,"pulse-color":e.nodePulseColor,pulsable:e.nodePulsable,deletable:e.nodeDeletable,dragging:e.draggedNode===t.id,selected:e.selectedNode===t.id,"port-disabled":e.portDisabled,"port-available":e.portAvailable,"active-port":e.activePort,"hovered-port":e.hoveredPort},on:{delete:e.deleteNode,"drag-start":e.onNodeDragStart,"resize-start":e.onNodeResizeStart,"hovered-port":e.setHoveredPort,"active-port":e.setActivePort},scopedSlots:e._u([{key:"default",fn:function(n){return[e._t("default",null,{node:t},n)]}}],null,!0)})})),e.newLink?n("line",{staticStyle:{stroke:"rgb(255,0,0)","stroke-width":"2"},attrs:{x1:e.newLink.x1,y1:e.newLink.y1,x2:e.newLink.x2,y2:e.newLink.y2,"pointer-events":"none"}}):e._e()],2)])};i._withStripped=!0;var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("g",{attrs:{id:e.node.id}},[e.pulsable(e.node)?n("rect",{staticClass:"diagram--editor__pulse",attrs:{fill:e.pulseColor(e.node),stroke:e.pulseColor(e.node),x:e.node.x,y:e.node.y,rx:"3",ry:"3",width:e.node.width,height:e.node.height}}):e._e(),n("rect",{attrs:{fill:e.color(e.node),stroke:"#000000","stroke-width":e.selected?1:0,x:e.node.x,y:e.node.y,rx:"3",ry:"3",width:e.node.width,height:e.node.height}}),n("DiagramNodeTitle",{attrs:{x:e.node.x+2,y:e.node.y+2,width:e.node.size.width-4,title:e.node.title,dragging:e.dragging,deletable:e.nodeDeletable},on:{delete:e.deleteNode},nativeOn:{mousedown:function(t){return t.stopPropagation(),e.onDragStart(t)}}}),n("rect",{staticClass:"node-light-background",attrs:{fill:"#ffffff",x:e.node.x+2,y:e.node.y+20,rx:"3",ry:"3",width:e.node.width-4,height:e.node.height-22}}),n("foreignObject",{attrs:{x:e.node.x+2,y:e.node.y+20,width:e.slotWidth,height:e.slotHeight}},[n("body",{staticClass:"diagram-editor__node-body",attrs:{xmlns:"http://www.w3.org/1999/xhtml"}},[e._t("default",null,{width:e.slotWidth,height:e.slotHeight})],2)]),n("svg",{attrs:{x:e.node.x-4,y:e.node.y+e.node.height-e.portsHeight-2,width:e.node.width+8,height:e.portsHeight}},[e._l(e.portsIn,(function(t,r){var i=t[0],o=t[1];return n("DiagramPort",{key:e.node.id+"_in_"+i,attrs:{id:e.node.id+"_in_"+i,title:o,width:r+1>e.portsOut.length?e.node.width:e.node.width/2,x:0,y:18*r,disabled:e.portsInDisabled[i],available:e.portsInAvailable[i],hovered:e.isHoveredPort("in",i),align:"start"},on:{mousedown:function(t){return e.mouseDownPort("in",i,t)},mouseenter:function(t){return e.mouseEnterPort("in",i,t)},mouseleave:function(t){return e.mouseLeavePort("in",i,t)}}})})),e._l(e.portsOut,(function(t,r){var i=t[0],o=t[1];return n("DiagramPort",{key:e.node.id+"_out_"+i,attrs:{id:e.node.id+"_out_"+i,title:o,width:e.node.width+8,x:0,y:18*r,disabled:e.portsOutDisabled[i],available:e.portsOutAvailable[i],hovered:e.isHoveredPort("out",i),align:"end"},on:{mousedown:function(t){return e.mouseDownPort("out",i,t)},mouseenter:function(t){return e.mouseEnterPort("out",i,t)},mouseleave:function(t){return e.mouseLeavePort("out",i,t)}}})}))],2),n("svg",{attrs:{width:"10",height:"10",x:e.node.x+e.node.width-10,y:e.node.y+e.node.height-10},on:{mousedown:e.onResizeStart}},[n("path",{staticStyle:{cursor:"nwse-resize"},attrs:{d:"M 0,10 10,0 v 10 z",fill:"#000"}})])],1)};o._withStripped=!0;var s=n(2);function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var a=function e(t){var n=t.x,r=void 0===n?10:n,i=t.y,o=void 0===i?10:i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),d(this,"x",null),d(this,"y",null),this.x=Number(r),this.y=Number(o)};function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var l=function e(t){var n=t.width,r=void 0===n?150:n,i=t.height,o=void 0===i?150:i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),u(this,"width",null),u(this,"height",null),this.width=Number(r),this.height=Number(o)};function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var p=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),f(this,"id",null),f(this,"title",null),f(this,"size",null),f(this,"coordinates",null),f(this,"data",{}),f(this,"portsIn",{}),f(this,"portsOut",{}),this.id=e.prepareProp("id",t.id),this.title=t.title,this.coordinates=e.prepareProp("coordinates",t.coordinates),this.size=e.prepareProp("size",t.size),this.data=e.prepareProp("data",t.data),this.portsIn=e.prepareProp("portsIn",t.portsIn),this.portsOut=e.prepareProp("portsOut",t.portsOut)}var t,n,r;return t=e,r=[{key:"prepareProp",value:function(e,t){switch(e){case"id":return t||Object(s.ulid)();case"coordinates":return new a(t||{});case"size":return new l(t||{});case"portsIn":case"portsOut":return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){f(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t||{});case"data":return t||{};default:return t}}},{key:"intersect",value:function(e,t){return!(e.x>t.x1||t.x>e.x1||e.y>t.y1||t.y>e.y1)}}],(n=[{key:"portsHeight",get:function(){return Math.max(Object.keys(this.portsIn).length,Object.keys(this.portsOut).length)*e.PORT_HEIGHT}},{key:"width",get:function(){return this.size.width}},{key:"height",get:function(){return this.size.height}},{key:"x",get:function(){return this.coordinates.x}},{key:"y",get:function(){return this.coordinates.y}},{key:"x1",get:function(){return this.coordinates.x+this.size.width}},{key:"y1",get:function(){return this.coordinates.y+this.size.height}},{key:"getPortCoordinates",value:function(t,n){if(!["in","out"].includes(t))throw new Error("Undefined port type "+t);var r=Object.keys("in"===t?this.portsIn:this.portsOut).findIndex((function(e){return e===n}));if(-1===r)throw new Error('"'.concat(t,'" port with name "').concat(n,'" is undefined!'));return{x:this.x+("out"===t?this.width:1),y:this.y+this.height-(this.portsHeight-2)+r*e.PORT_HEIGHT+1}}}])&&h(t.prototype,n),r&&h(t,r),e}();f(p,"PORT_HEIGHT",18);var g=function(e,t){var n=t._c;return n("svg",{attrs:{x:t.props.x,y:t.props.y,width:t.props.width,height:"16"}},[n("rect",t._g({attrs:{fill:t.$options.fill(t.props.available,t.props.hovered),x:"start"===t.props.align?0:t.props.width-10,y:"0",rx:"5",ry:"5",cursor:t.props.disabled?"default":"pointer",width:"10",height:"10"}},t.listeners)),n("text",{attrs:{x:"start"===t.props.align?12:t.props.width-12,y:"9","font-size":"8pt","text-anchor":t.props.align}},[t._v("\n    "+t._s(t.props.title)+"\n  ")])])};g._withStripped=!0;function v(e,t,n,r,i,o,s,d){var a,u="function"==typeof e?e.options:e;if(t&&(u.render=t,u.staticRenderFns=n,u._compiled=!0),r&&(u.functional=!0),o&&(u._scopeId="data-v-"+o),s?(a=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),i&&i.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(s)},u._ssrRegister=a):i&&(a=d?function(){i.call(this,(u.functional?this.parent:this).$root.$options.shadowRoot)}:i),a)if(u.functional){u._injectStyles=a;var l=u.render;u.render=function(e,t){return a.call(t),l(e,t)}}else{var c=u.beforeCreate;u.beforeCreate=c?[].concat(c,a):[a]}return{exports:e,options:u}}var y=v({fill:function(e,t){return e?t?"#04ff00":"#f00":t?"#888":"#444"}},g,[],!0,null,null,null);y.options.__file="src/components/DiagramPort.vue";var b=y.exports,m=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("svg",{style:{cursor:e.dragging?"grabbing":"grab"},attrs:{x:e.x,y:e.y,width:e.width,height:"16"},on:{mouseenter:function(t){e.hover=!0},mouseleave:function(t){e.hover=!1}}},[n("rect",{attrs:{fill:"#000","fill-opacity":e.titleFillOpacity,x:"0",y:"0",rx:"3",ry:"3",width:e.width,height:"16"}}),n("svg",{attrs:{x:"0",y:"0",width:e.deletable?e.width-17:e.width,height:"16"}},[n("title",[e._v(e._s(e.title))]),n("text",{attrs:{x:"2",y:"13","font-size":"15","font-weight":"normal",fill:"#fff"}},[e._v(e._s(e.title))])]),e.deletable?n("svg",{staticClass:"diagram-editor__delete",attrs:{x:e.width-15,y:"1",width:"14",height:"14"},on:{click:function(t){return e.$emit("delete")}}},[n("rect",{attrs:{x:"0",y:"0",width:"14",height:"14",rx:"2",ry:"2"}}),n("line",{attrs:{x1:1,y1:1,x2:13,y2:13}}),n("line",{attrs:{x1:13,y1:1,x2:1,y2:13}})]):e._e()])};m._withStripped=!0;var w=v({name:"DiagramNodeTitle",props:{x:{type:Number,required:!0},y:{type:Number,required:!0},width:{type:Number,required:!0},title:{type:String,required:!0},deletable:{type:Boolean,default:!0},dragging:{type:Boolean,default:!1}},data:function(){return{hover:!1}},computed:{titleFillOpacity:function(){return this.hover?.7:.5}}},m,[],!1,null,null,null);w.options.__file="src/components/DiagramNodeTitle.vue";var P=w.exports,x=n(1),k=n.n(x);function _(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function O(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_(Object(n),!0).forEach((function(t){D(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function D(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var z=v({name:"DiagramNode",components:{DiagramNodeTitle:P,DiagramPort:b},props:{node:{type:p,required:!0},color:{type:Function,required:!0},pulseColor:{type:Function,required:!0},pulsable:{type:Function,required:!0},portDisabled:{type:Function,required:!0},portAvailable:{type:Function,required:!0},deletable:{type:Function,required:!0},activePort:{type:Object,default:null},hoveredPort:{type:Object,default:null},selected:{type:Boolean,default:!1},dragging:{type:Boolean,default:!1}},data:function(){return{nodeStrokeWidth:0,titleFillOpacity:.25}},computed:{portsIn:function(){return Object.entries(this.node.portsIn)},portsOut:function(){return Object.entries(this.node.portsOut)},portsInDisabled:function(){var e=this;return Object.keys(this.node.portsIn).reduce((function(t,n){return O(O({},t),{},D({},n,e.portDisabled({id:e.node.id,type:"in",port:n})))}),{})},portsOutDisabled:function(){var e=this;return Object.keys(this.node.portsOut).reduce((function(t,n){return O(O({},t),{},D({},n,e.portDisabled({id:e.node.id,type:"out",port:n})))}),{})},portsInAvailable:function(){var e=this;return Object.keys(this.node.portsIn).reduce((function(t,n){return O(O({},t),{},D({},n,e.activePort&&e.isAvailablePort("in",n)))}),{})},portsOutAvailable:function(){var e=this;return Object.keys(this.node.portsOut).reduce((function(t,n){return O(O({},t),{},D({},n,e.activePort&&e.isAvailablePort("out",n)))}),{})},portsHeight:function(){return this.node.portsHeight},slotWidth:function(){return this.node.size.width-4},slotHeight:function(){return this.node.size.height-22},nodeDeletable:function(){return this.deletable(this.node)}},methods:{isAvailablePort:function(e,t){var n={id:this.node.id,type:e,port:t},r=O({},this.activePort),i=this.hoveredPort?O({},this.hoveredPort):null;return!(!!i&&k()(r,i))&&!k()(r,n)&&this.portAvailable(O(O({},n),{},{activePort:O({},this.activePort)}))},deleteNode:function(){this.$emit("delete",this.node.id)},onDragStart:function(e){this.$emit("drag-start",{node:this.node,eX:e.x,eY:e.y})},onResizeStart:function(e){this.$emit("resize-start",{node:this.node,eX:e.x,eY:e.y})},isHoveredPort:function(e,t){return this.hoveredPort&&this.node.id===this.hoveredPort.id&&t===this.hoveredPort.port&&e===this.hoveredPort.type},mouseDownPort:function(e,t){("in"===e?this.portsInDisabled[t]:this.portsOutDisabled[t])||this.$emit("active-port",{id:this.node.id,port:t,type:e})},mouseEnterPort:function(e,t){this.$emit("hovered-port",{id:this.node.id,port:t,type:e})},mouseLeavePort:function(){this.$emit("hovered-port",null)}}},o,[],!1,null,null,null);z.options.__file="src/components/DiagramNode.vue";var N=z.exports,C=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("g",{on:{mouseenter:function(t){e.hovered=!0},mouseleave:function(t){e.hovered=!1},mousedown:function(t){return e.$emit("mousedown",t)}}},[n("path",{style:e.largeStrokeStyle,attrs:{d:e.curve,"stroke-width":"8",fill:"none"}}),n("path",{staticStyle:{stroke:"rgb(0,0,0)"},attrs:{d:e.curve,"stroke-width":"2",fill:"none"}})])};function j(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}C._withStripped=!0;var E=function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),j(this,"id",null),j(this,"start_id",null),j(this,"start_port",null),j(this,"end_id",null),j(this,"end_port",null),this.id=t.id||Object(s.ulid)(),!t.start_id)throw new Error("start_id is empty!");if(this.start_id=t.start_id,this.start_port=t.start_port||"default",!t.end_id)throw new Error("end_id is empty!");this.end_id=t.end_id,this.end_port=t.end_port||"default"},S=v({name:"DiagramLink",props:{link:{type:E,required:!0},nodeStart:{type:p,required:!0},nodeEnd:{type:p,required:!0},selected:{type:Boolean,default:!1}},data:function(){return{hovered:!1}},computed:{startCoordinates:function(){return this.nodeStart.getPortCoordinates("out",this.link.start_port)},endCoordinates:function(){return this.nodeEnd.getPortCoordinates("in",this.link.end_port)},x1:function(){return this.startCoordinates.x-2},y1:function(){return this.startCoordinates.y},x2:function(){return this.endCoordinates.x+1},y2:function(){return this.endCoordinates.y},curve:function(){var e=Math.trunc(this.x1),t=Math.trunc(this.y1),n=Math.trunc(this.x2),r=Math.trunc(this.y2),i=Math.trunc(4*Math.sqrt(Math.abs(e-n)))+10;return"M".concat(e,",").concat(t," C").concat(e+i,",").concat(t," ").concat(n-i,",").concat(r," ").concat(n,",").concat(r)},largeStrokeStyle:function(){return this.selected?this.hovered?"stroke:rgba(0,0,255,0.6);":"stroke:rgba(0,0,255,0.4);":this.hovered?"stroke:rgba(255,0,0,0.5);":"stroke:rgba(255,0,0,0.0);"}}},C,[],!1,null,null,null);S.options.__file="src/components/DiagramLink.vue";var M=S.exports,$=n(0),L=n.n($),q=function(e,t){return t*Math.round(e/t)},Z=n(3),B=n.n(Z);function I(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function F(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?I(Object(n),!0).forEach((function(t){R(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):I(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function R(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var W=n(4),H=n.n(W),T=v({name:"DiagramRoot",components:{DiagramNode:N,DiagramLink:M},mixins:[{data:function(){return{nodes:{},links:{},draggedNode:null,resizedNode:null,selectedNode:null,selectedLink:null,initialCursorOffset:{x:0,y:0},activePort:null,hoveredPort:null,nodeCoordinatesBeforeDrag:{x:0,y:0},nodeSizeBeforeResize:{width:0,height:0},currentCursorPos:null}},computed:{newLink:function(){if(!this.activePort||null===this.currentCursorPos)return null;var e=this.activePort,t=e.id,n=e.type,r=e.port,i=this.nodes[t].getPortCoordinates(n,r);return{x1:i.x,y1:i.y,x2:this.currentCursorPos.x,y2:this.currentCursorPos.y}}},watch:{selectedNode:function(e){e&&this.$emit("select-node",e)},draggedNode:function(e){if(e){var t=this.nodes[e];this.nodeCoordinatesBeforeDrag=F({},t.coordinates)}this.toggleMoveEventListener(null!==e)},resizedNode:function(e){if(e){var t=this.nodes[e];this.nodeSizeBeforeResize=F({},t.size)}this.toggleMoveEventListener(null!==e)},activePort:function(e){this.toggleMoveEventListener(null!==e)}},methods:{setModel:function(e){this.nodes=Object.values(e.nodes||[]).reduce((function(e,t){var n=new p(t);return F(F({},e),{},R({},n.id,n))}),{}),this.links=Object.values(e.links||[]).reduce((function(e,t){var n=new E(t);return F(F({},e),{},R({},n.id,n))}),{})},beforePan:function(){return this.pan&&!(this.draggedNode||this.resizedNode||this.activePort)},addNode:function(e){var t=new p(e);L.a.set(this.nodes,t.id,t)},addLink:function(e){var t=new E(e);L.a.set(this.links,t.id,t)},deleteNode:function(e){var t=this.nodes[e];if(!1!==this.beforeDeleteNode(t)){for(var n in L.a.delete(this.nodes,e),this.links)if(this.links.hasOwnProperty(n)){var r=this.links[n];r.start_id!==e&&r.end_id!==e||L.a.delete(this.links,n)}this.$emit("deleted-node",e)}},deleteLink:function(e){!1!==this.beforeDeleteLink(this.links[e])&&(L.a.delete(this.links,e),this.$emit("deleted-link",e))},selectLink:function(e){this.selectedLink=e},clearSelection:function(){this.selectedNode=null,this.selectedLink=null},toggleMoveEventListener:function(e){e?(document.body.addEventListener("mousemove",this.mouseMove),document.body.addEventListener("mouseup",this.mouseUp)):(document.body.removeEventListener("mousemove",this.mouseMove),document.body.removeEventListener("mouseup",this.mouseUp))},mouseMove:function(e){if(this.draggedNode||this.resizedNode)this.dragMove({gridSnap:this.gridSnap,x:e.x,y:e.y});else if(this.activePort){var t=this.convertXYtoViewPort(e.pageX,e.pageY),n=t.x,r=t.y;this.currentCursorPos={x:n,y:r}}},mouseUp:function(){if(this.draggedNode||this.resizedNode){var e=this.draggedNode||this.resizedNode,t=e?this.nodes[e]:null,n=!!this.draggedNode,r=this.draggedNode&&!k()(F({},t.coordinates),F({},this.nodeCoordinatesBeforeDrag))||this.resizedNode&&!k()(F({},t.size),F({},this.nodeSizeBeforeResize));this.dragEnd(),r?this.$emit("updated-node",t):n&&(this.selectedNode=e)}else if(this.activePort){var i=F({},this.activePort);if(this.hoveredPort){var o=F({},this.hoveredPort);if(k()(i,o))this.$emit("click-port",i);else if(this.portAvailable(F(F({},o),{},{activePort:i}))){var s=new E({start_id:i.id,start_port:i.port,end_id:o.id,end_port:o.port});L.a.set(this.links,s.id,s),this.$emit("created-link",s)}}this.activePort=null,this.currentCursorPos=null}},serialize:function(){return{nodes:Object.values(this.nodes).map((function(e){return B()(e)})),links:Object.values(this.links).map((function(e){return B()(e)}))}},dragStart:function(e){var t=e.id,n=e.offset,r=e.type;"drag"===r?(this.draggedNode=t,this.resizedNode=null):"resize"===r&&(this.draggedNode=null,this.resizedNode=t),this.initialCursorOffset=n},dragMove:function(e){var t=this,n=e.gridSnap,r=e.x,i=e.y,o=function(e,r){var i=t.convertXYtoViewPort(e,r),o=i.x,s=i.y;return o=q(o,n)-n/2,s=q(s,n),{x:o-=t.initialCursorOffset.x,y:s-=t.initialCursorOffset.y}};if(this.draggedNode&&this.updateNode({id:this.draggedNode,name:"coordinates",value:new a(o(r,i))}),this.resizedNode){var s=this.nodes[this.resizedNode],d=o(r,i),u=new l({width:Math.abs(d.x-s.coordinates.x),height:Math.abs(d.y-s.coordinates.y)});u.width<30&&(u.width=30),u.height<30&&(u.height=30),this.updateNode({id:this.resizedNode,name:"size",value:u})}},dragEnd:function(){this.draggedNode=null,this.resizedNode=null},updateNode:function(e){var t=e.id,n=e.name,r=e.value;L.a.set(this.nodes[t],n,p.prepareProp(n,r))}}},{data:function(){return{spz:null}},mounted:function(){var e=this;this.spz=H()(this.$refs.diagramRoot,{viewportSelector:this.$refs.viewPort,center:!1,preventMouseEventsDefault:this.preventMouseEventsDefault,beforePan:this.beforePan,beforeZoom:function(){return e.zoomEnabled}})},beforeDestroy:function(){this.spz&&this.spz.destroy()},methods:{enableDblClickZoom:function(){if(this.spz)return this.spz.enableDblClickZoom()},disableDblClickZoom:function(){if(this.spz)return this.spz.disableDblClickZoom()},isDblClickZoomEnabled:function(){if(this.spz)return this.spz.isDblClickZoomEnabled()},enableMouseWheelZoom:function(){if(this.spz)return this.spz.enableMouseWheelZoom()},disableMouseWheelZoom:function(){if(this.spz)return this.spz.disableMouseWheelZoom()},isMouseWheelZoomEnabled:function(){if(this.spz)return this.spz.isMouseWheelZoomEnabled()},resetZoom:function(){if(this.spz)return this.spz.resetZoom()},updateBBox:function(){if(this.spz)return this.spz.updateBBox()},fit:function(){if(this.spz)return this.spz.fit()},contain:function(){if(this.spz)return this.spz.contain()},center:function(){if(this.spz)return this.spz.center()}}}],props:{width:{type:Number,default:0},height:{type:Number,required:!0},gridSnap:{type:Number,required:!0},zoomEnabled:{type:Boolean,required:!0},nodeColor:{type:Function,required:!0},nodePulseColor:{type:Function,required:!0},nodePulsable:{type:Function,required:!0},nodeDeletable:{type:Function,required:!0},beforeDeleteNode:{type:Function,required:!0},beforeDeleteLink:{type:Function,required:!0},portDisabled:{type:Function,required:!0},portAvailable:{type:Function,required:!0},pan:{type:Boolean,required:!0},preventMouseEventsDefault:{type:Boolean,default:!0}},computed:{uniqId:function(){return Object(s.ulid)()}},mounted:function(){document.addEventListener("keydown",this.keyDownHandler)},beforeDestroy:function(){document.removeEventListener("keydown",this.keyDownHandler)},methods:{keyDownHandler:function(e){46===e.keyCode&&(this.selectedNode&&this.nodeDeletable(this.nodes[this.selectedNode])&&this.deleteNode(this.selectedNode),this.selectedLink&&this.deleteLink(this.selectedLink)),27===e.keyCode&&this.clearSelection()},convertXYtoViewPort:function(e,t){var n,r,i,o,s,d=this.$refs.diagramRoot,a=this.$refs.viewPort,u=d.createSVGPoint(),l=(n=d,r=document.documentElement,i=n.getBoundingClientRect(),o=r.scrollLeft,s=r.scrollTop,{x:i.left+o,y:i.top+s});u.x=e-l.x,u.y=t-l.y;var c=a.getCTM().inverse();return u.matrixTransform(c)},onNodeDragStart:function(e){var t=e.node,n=e.eX,r=e.eY,i=this.convertXYtoViewPort(n,r),o=i.x,s=i.y;this.dragStart({type:"drag",id:t.id,offset:{x:Math.round(o-t.x),y:Math.round(s-t.y)}})},onNodeResizeStart:function(e){var t=e.node,n=e.eX,r=e.eY,i=this.convertXYtoViewPort(n,r),o=i.x,s=i.y;this.dragStart({type:"resize",id:t.id,offset:{x:-Math.round(t.x+t.width-o),y:-Math.round(t.y+t.height-s)}})},setActivePort:function(e){this.activePort=e},setHoveredPort:function(e){this.hoveredPort=e}}},i,[],!1,null,null,null);T.options.__file="src/components/DiagramRoot.vue";var A=T.exports,X=n(5),Y=v({name:"Diagram",components:{DiagramRoot:A},props:{height:{type:Number,default:500},gridSnap:{type:Number,default:1},zoomEnabled:{type:Boolean,default:!0},nodeColor:{type:Function,default:function(){return"#66cc00"}},nodePulseColor:{type:Function,default:function(){return"#f00"}},nodePulsable:{type:Function,default:function(){return!1}},nodeDeletable:{type:Function,default:function(){return!0}},beforeDeleteNode:{type:Function,default:function(){return!0}},beforeDeleteLink:{type:Function,default:function(){return!0}},portDisabled:{type:Function,default:function(){return!1}},portAvailable:{type:Function,default:function(){return!0}},pan:{type:Boolean,default:!0},preventMouseEventsDefault:{type:Boolean,default:!0}},data:function(){return{width:null}},mounted:function(){window.addEventListener("resize",this.updateWrapperWidth),this.updateWrapperWidth()},beforeDestroy:function(){window.removeEventListener("resize",this.updateWrapperWidth)},methods:{updateWrapperWidth:n.n(X)()((function(){var e=this.$el.getBoundingClientRect().width;this.width=e}),100),setModel:function(e){this.$refs.diagram.setModel(e)},serialize:function(){return this.$refs.diagram.serialize()},addNode:function(e){this.$refs.diagram.addNode(e)},addLink:function(e){this.$refs.diagram.addLink(e)},updateNode:function(e){var t=e.id,n=e.name,r=e.value;this.$refs.diagram.updateNode({id:t,name:n,value:r})},deleteNode:function(e){this.$refs.diagram.deleteNode(e)},deleteLink:function(e){this.$refs.diagram.deleteLink(e)},enableDblClickZoom:function(){return this.$refs.diagram.enableDblClickZoom()},disableDblClickZoom:function(){return this.$refs.diagram.disableDblClickZoom()},isDblClickZoomEnabled:function(){return this.$refs.diagram.isDblClickZoomEnabled()},enableMouseWheelZoom:function(){return this.$refs.diagram.enableMouseWheelZoom()},disableMouseWheelZoom:function(){return this.$refs.diagram.disableMouseWheelZoom()},isMouseWheelZoomEnabled:function(){return this.$refs.diagram.isMouseWheelZoomEnabled()},resetZoom:function(){return this.$refs.diagram.resetZoom()},updateBBox:function(){return this.$refs.diagram.updateBBox()},fit:function(){return this.$refs.diagram.fit()},contain:function(){return this.$refs.diagram.contain()},center:function(){return this.$refs.diagram.center()}}},r,[],!1,null,null,null);Y.options.__file="src/components/Diagram.vue";var U=Y.exports;n(6),t.default=U}]);
//# sourceMappingURL=vue-diagram-editor.cjs.min.js.map